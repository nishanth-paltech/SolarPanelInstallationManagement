@{
    ViewData["Title"] = "Consumer Survey";
}

    <div class="container-fluid mt-4">
        <div class="d-flex justify-content-between mb-3">
            <h3>Consumer Survey</h3>
            <a class="btn btn-primary" asp-action="Create">Add New</a>
        </div>
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
                <button class="btn btn-outline-secondary dropdown-toggle"
                        type="button"
                        data-bs-toggle="dropdown">
                    Columns
                </button>

                <ul class="dropdown-menu p-3" id="columnToggleMenu">
                    <!-- checkboxes added via JS -->
                </ul>
            </div>
        </div>
        <table id="consumerSurveyTable" class="table table-striped table-bordered w-100">
            <thead>
                <tr>
                    <th>S.No</th>
                    <th>District</th>
                    <th>Mandal</th>
                    <th>Village</th>
                    <th>Consumer Name</th>
                    <th>Service Number</th>
                    <th>Mobile</th>
                    <th>Actions</th>
                </tr>
                <tr>
                    <th></th>
                    <th><input type="text" class="form-control form-control-sm column-search" /></th>
                    <th><input type="text" class="form-control form-control-sm column-search" /></th>
                    <th><input type="text" class="form-control form-control-sm column-search" /></th>
                    <th></th>
                    <th><input type="text" class="form-control form-control-sm column-search" /></th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>

        </table>
    </div>

@section Scripts {
    <script>
        $(document).ready(function () {

            var table = $('#consumerSurveyTable').DataTable({
                processing: true,
                serverSide: true,
                orderCellsTop: true,
                stateSave: true,   // ✅ remembers column visibility
                ajax: {
                    url: '@Url.Action("GetData", "ConsumerSurvey")',
                    type: 'POST'
                },
                columns: [
                    { data: 'sno', title: 'S.No' },
                    { data: 'district', title: 'District' },
                    { data: 'mandal', title: 'Mandal' },
                    { data: 'village', title: 'Village' },
                    { data: 'consumerNameWithSurname', title: 'Consumer Name' },
                    { data: 'serviceNumber', title: 'Service Number' },
                    { data: 'consumerMobileNo', title: 'Mobile' },
                    { data: 'sno', title: 'Actions', orderable: false }
                ]
            });

            // Build column toggle menu
            table.columns().every(function (index) {
                var column = this;
                var columnName = $(column.header()).text();

                // Skip Actions column if you want
                if (columnName === 'Actions') return;

                $('#columnToggleMenu').append(`
                    <li>
                        <div class="form-check">
                            <input class="form-check-input column-toggle"
                                   type="checkbox"
                                   checked
                                   data-column="${index}">
                            <label class="form-check-label">
                                ${columnName}
                            </label>
                        </div>
                    </li>
                `);
            });

            // Toggle column visibility
            $(document).on('change', '.column-toggle', function () {
                var columnIndex = $(this).data('column');
                var column = table.column(columnIndex);

                column.visible(!column.visible());
            });

            // Column search
            $('#consumerSurveyTable thead').on('keyup', '.column-search', function () {
                var index = $(this).parent().index();
                table.column(index).search(this.value).draw();
            });
        });

    </script>
}
